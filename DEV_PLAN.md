# –ü–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ Telegram Mini App "–ê–¥–≤–µ–Ω—Ç-–ö–∞–ª–µ–Ω–¥–∞—Ä—å" (Re-Build)

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —è–≤–ª—è–µ—Ç—Å—è –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –∏—Å—Ç–∏–Ω—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.
–¶–µ–ª—å: –°–æ–∑–¥–∞—Ç—å —á–∏—Å—Ç–æ–µ, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π Supabase –∏ Telegram Stars.

## üõ† –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫
- **Frontend:** React, Vite, Tailwind CSS.
- **Backend:** Supabase (Database, Edge Functions).
- **Telegram:** WebApp API (—Å—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è initData).

## ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ (Architecture Guardrails)
1.  **–ó–∞–ø—Ä–µ—Ç –Ω–∞ —Ñ–µ–π–∫–æ–≤—ã–µ ID:** –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¢–û–õ–¨–ö–û —á–µ—Ä–µ–∑ `Telegram.WebApp.initData`. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `Date.now()` –∏–ª–∏ —Å–ª—É—á–∞–π–Ω—ã—Ö —á–∏—Å–µ–ª –∑–∞–ø—Ä–µ—â–µ–Ω–æ.
2.  **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å—Ç–µ–π—Ç:** –í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏–º—è, –ø—Ä–æ–≥—Ä–µ—Å—Å, —Å—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã) —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `AuthContext`.
3.  **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Ç–∏–ø–æ–≤:** ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑–µ ‚Äî `TEXT` (—Å—Ç—Ä–æ–∫–∞), —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è JS Number.

---

## üìÖ –≠–¢–ê–ü 1: –§—É–Ω–¥–∞–º–µ–Ω—Ç –∏ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (Core)
*–ó–∞–¥–∞—á–∞: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–≤—è–∑—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å Supabase –∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.*

1.  **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase Client (`src/lib/supabaseClient.js`)**
    * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è `VITE_SUPABASE_URL` –∏ `VITE_SUPABASE_ANON_KEY`.
2.  **–•—É–∫ Telegram (`src/hooks/useTelegram.js`)**
    * –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ `tgUser` –∏–∑ `window.Telegram.WebApp`.
    * –ú–µ—Ç–æ–¥—ã `tg.ready()`, `tg.expand()`.
3.  **–ö–æ–Ω—Ç–µ–∫—Å—Ç –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (`src/context/AuthContext.jsx`)**
    * –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ: –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ `tgUser`.
    * –ï—Å–ª–∏ –µ—Å—Ç—å -> –¥–µ–ª–∞–µ–º `SELECT` –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `users`.
    * –ï—Å–ª–∏ –∑–∞–ø–∏—Å–∏ –Ω–µ—Ç (–Ω–æ–≤—ã–π —é–∑–µ—Ä) -> –Ω–µ —Å–æ–∑–¥–∞–µ–º —Å—Ä–∞–∑—É, –∂–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –û–Ω–±–æ—Ä–¥–∏–Ω–≥–∞.
    * –ï—Å–ª–∏ –∑–∞–ø–∏—Å—å –µ—Å—Ç—å -> –∑–∞–≥—Ä—É–∂–∞–µ–º `current_day`, `is_paid`, `name`.
    * **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–Ω–∞–µ—Ç, –∫—Ç–æ –∑–∞—à–µ–ª, –∏–ª–∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø, –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ –Ω–µ –≤ Telegram.

## üé® –≠–¢–ê–ü 2: UI –ö–∞—Ä–∫–∞—Å –∏ –û–Ω–±–æ—Ä–¥–∏–Ω–≥
*–ó–∞–¥–∞—á–∞: –°–¥–µ–ª–∞—Ç—å –≤—Ö–æ–¥ –∏ —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö.*

1.  **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç `Layout.jsx`**
    * –§–æ–Ω, –ø–∞–¥–∞—é—â–∏–π —Å–Ω–µ–≥ (CSS), –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞.
2.  **–°—Ç—Ä–∞–Ω–∏—Ü–∞ `Onboarding.jsx`**
    * –§–æ—Ä–º–∞: –ò–º—è, –ü–æ–ª (Boy/Girl), –ì–æ—Ä–æ–¥, –•–æ–±–±–∏.
    * –ö–Ω–æ–ø–∫–∞ "–ù–∞—á–∞—Ç—å": –î–µ–ª–∞–µ—Ç `INSERT` –≤ —Ç–∞–±–ª–∏—Ü—É `users` —Å —Ä–µ–∞–ª—å–Ω—ã–º `telegram_id`.
    * –ü–æ—Å–ª–µ —É—Å–ø–µ—Ö–∞ -> —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/calendar`.
3.  **–†–æ—É—Ç–∏–Ω–≥ (`App.jsx`)**
    * –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤. –ó–∞—â–∏—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–∞ `/calendar` (—Ä–µ—à–∏—Ä–µ–∫—Ç –Ω–∞ `/onboarding`, –µ—Å–ª–∏ –Ω–µ—Ç –ø—Ä–æ—Ñ–∏–ª—è).

## üóì –≠–¢–ê–ü 3: –ö–∞–ª–µ–Ω–¥–∞—Ä—å –∏ –ú–µ—Ö–∞–Ω–∏–∫–∞ –î–Ω–µ–π
*–ó–∞–¥–∞—á–∞: –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –¥–Ω–µ–π.*

1.  **–°—Ç—Ä–∞–Ω–∏—Ü–∞ `Calendar.jsx`**
    * Grid-—Å–µ—Ç–∫–∞ 10 –¥–Ω–µ–π.
    * **–õ–æ–≥–∏–∫–∞ –∫–∞—Ä—Ç–æ—á–∫–∏:**
        * `Done` (–∑–µ–ª–µ–Ω–∞—è –≥–∞–ª–æ—á–∫–∞): `day < current_day`.
        * `Active` (–º–æ–∂–Ω–æ –∏–≥—Ä–∞—Ç—å): `day === current_day`.
        * `Locked` (–∑–∞–º–æ–∫): `day > current_day` –ò–õ–ò (`day > 1` –∏ `!is_paid`).
    * –ö–ª–∏–∫ –ø–æ –∑–∞–∫—Ä—ã—Ç–æ–º—É –ø–ª–∞—Ç–Ω–æ–º—É –¥–Ω—é -> –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç `PaywallModal`.

## üéÆ –≠–¢–ê–ü 4: –ò–≥—Ä–æ–≤–æ–π –î–≤–∏–∂–æ–∫
*–ó–∞–¥–∞—á–∞: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å 5 —Ç–∏–ø–æ–≤ –º–µ—Ö–∞–Ω–∏–∫.*

1.  **–ö–æ–Ω—Ñ–∏–≥ `src/data/quests.js`**
    * –ü–µ—Ä–µ–Ω–æ—Å –≤—Å–µ—Ö —Ç–µ–∫—Å—Ç–æ–≤, –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤ –≤ JSON-—Å—Ç—Ä—É–∫—Ç—É—Ä—É.
2.  **–ú–∏–Ω–∏-–∏–≥—Ä—ã (Components)**
    * `GameInput`: –ü–æ–ª–µ –≤–≤–æ–¥–∞ + –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Å—Å–∏–≤–∞ –æ—Ç–≤–µ—Ç–æ–≤.
    * `GameQuiz`: 4 –≤–∞—Ä–∏–∞–Ω—Ç–∞ –æ—Ç–≤–µ—Ç–∞.
    * `GameClicker`: –ö–Ω–æ–ø–∫–∞ + –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä + –≤–∏–±—Ä–∞—Ü–∏—è.
    * `GameSequence`: –í—ã–±–æ—Ä 3 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ.
    * `GameAnagram`: –°–±–æ—Ä —Å–ª–æ–≤–∞ –∏–∑ –±—É–∫–≤.
3.  **–°—Ç—Ä–∞–Ω–∏—Ü–∞ `DayPage.jsx` –∏ `GameEngine.jsx`**
    * –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–Ω—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞.
    * –í—ã–±–æ—Ä –Ω—É–∂–Ω–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –∏–≥—Ä—ã.
    * –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–±–µ–¥—ã (`handleWin`).

## ‚ú® –≠–¢–ê–ü 5: –°–∫–∞–∑–∫–∏ –∏ "–ú–∞–≥–∏—è"
*–ó–∞–¥–∞—á–∞: –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç.*

1.  **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è `openai.js`**
    * –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ñ—É–Ω–∫—Ü–∏–∏ —à–∞–±–ª–æ–Ω–∏–∑–∞—Ç–æ—Ä–∞.
2.  **–õ–æ–≥–∏–∫–∞ –ü–æ–±–µ–¥—ã (`DayPage.jsx`)**
    * –ü—Ä–∏ –ø–æ–±–µ–¥–µ: –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞.
    * **–í–∞–∂–Ω–æ:** –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ Supabase -> –∫–æ–ª–æ–Ω–∫–∞ `generated_stories` (JSONB).
    * `UPDATE users SET current_day = current_day + 1`.

## üí∞ –≠–¢–ê–ü 6: –ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è
*–ó–∞–¥–∞—á–∞: –ü–æ–¥–∫–ª—é—á–∏—Ç—å Telegram Stars.*

1.  **Edge Function `create-invoice` (–°—É—â–µ—Å—Ç–≤—É–µ—Ç)**
    * –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ –æ–ø–ª–∞—Ç—É.
2.  **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç `PaywallModal.jsx`**
    * –ö–Ω–æ–ø–∫–∞ "–ö—É–ø–∏—Ç—å –∑–∞ Stars".
    * –û–±—Ä–∞–±–æ—Ç–∫–∞ `Telegram.WebApp.openInvoice`.
    * –ü—Ä–∏ —É—Å–ø–µ—Ö–µ: –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI (`is_paid = true`) + —Ñ–æ–Ω–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î.

## üîî –≠–¢–ê–ü 7: Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (Cron)
*–ó–∞–¥–∞—á–∞: –í–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.*

1.  **Supabase Edge Function: `push-notification`**
    * –õ–æ–≥–∏–∫–∞: –í—ã–±—Ä–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —É –∫–æ—Ç–æ—Ä—ã—Ö `current_day <= 10` –ò `last_push_date != TODAY`.
    * –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Bot API.
    * –û–±–Ω–æ–≤–∏—Ç—å `last_push_date = TODAY`.
2.  **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Cron**
    * –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ HTTP —Ç—Ä–∏–≥–≥–µ—Ä–∞ –≤ Supabase Dashboard.