// src/lib/openai.js

// ШАБЛОНЫ ДЛЯ МАЛЬЧИКОВ
const TEMPLATES_BOY = {
  1: `Снеговик замер в изумлении! Он записал в свою Книгу Чудес: "{name} — настоящий волшебник!". Метель вокруг начала утихать, словно признавая твою первую победу. Кстати, Снеговик узнал, что твое любимое дело — {hobby}, и уверен, что это помогает тебе творить чудеса!`,
  2: `В лесу поднялся радостный переполох! Белки шептались, что в их края пришел очень внимательный герой по имени {name}. Ты так легко нашел лишнее, что даже старая мудрая Сова одобрительно ухнула с ветки. Тропинка свободна, идем дальше!`,
  3: `Олени сыты и невероятно счастливы! Вожак стаи, Рудольф, подошел к тебе и позволил погладить свой бархатный нос. Снеговик подмигнул: "{name}, у тебя доброе сердце, а это самое главное для новогоднего приключения!". Сани готовы к старту!`,
  4: `Какой чудесный аромат! Ты спас рождественское печенье, и теперь вся кухня Снеговика пахнет корицей и праздником. Главный Эльф-Кондитер пожал тебе руку: "{name}, у тебя отличный вкус! Сразу видно человека, который умеет находить правильные решения".`,
  5: `Гав-гав! Ура! Шарик прыгает от счастья, сжимая в зубах свой новый подарок. Он говорит на своем собачьем языке, что ты самый догадливый друг на свете. "{name}, твоя доброта растопит любой лед," — улыбнулся Снеговик. Ты находишь подход к каждому!`,
  6: `ДА БУДЕТ СВЕТ! Елка вспыхнула тысячей разноцветных огней, озаряя весь темный лес. Это не просто электричество, это магия твоих касаний! Снеговик восторженно достал бенгальский огонь: "{name}, ты даришь свет всем вокруг!"`,
  7: `Невероятно! Дерево выросло крепким и красивым всего за одну секунду! Сама природа слушается тебя. "{name}, да ты прирожденный садовник чудес!" — воскликнули маленькие эльфы. Твое терпение и труд принесли свои волшебные плоды. Мы почти у цели!`,
  8: `Ура! Кукла спасена! Она заняла свое почетное место в мешке подарков. Снеговик записал в блокнот: "{name} — мастер разгадывать тайны!". Буквы встали на свои места так четко, будто по взмаху волшебной палочки.`,
  9: `Тик-так! Часы пробили волшебный час. Ты победил само Время! Снеговик проверил свои большие карманные часы и выдохнул: "Мы успеваем! {name}, твоя скорость и острый ум просто поражают воображение!". Финал уже совсем близко!`,
  10: `УРА! САЛЮТ! Главная Елка Мира зажглась благодаря ТЕБЕ! Дед Мороз лично жмет твою руку. "{name}, ты совершил настоящее чудо!" Все испытания пройдены, путь к празднованию Нового года открыт! Пусть твое увлечение — {hobby} — приносит тебе радость весь год!`
};

// ШАБЛОНЫ ДЛЯ ДЕВОЧЕК
const TEMPLATES_GIRL = {
  1: `Снеговик замер в изумлении! Он записал в свою Книгу Чудес: "{name} — настоящая волшебница!". Метель вокруг начала утихать, словно признавая твою первую победу. Кстати, Снеговик узнал, что твое любимое дело — {hobby}, и уверен, что это помогает тебе творить чудеса!`,
  2: `В лесу поднялся радостный переполох! Белки шептались, что в их края пришла очень внимательная героиня по имени {name}. Ты так легко нашла лишнее, что даже старая мудрая Сова одобрительно ухнула с ветки. Тропинка свободна, идем дальше!`,
  3: `Олени сыты и невероятно счастливы! Вожак стаи, Рудольф, подошел к тебе и позволил погладить свой бархатный нос. Снеговик подмигнул: "{name}, у тебя доброе сердце, а это самое главное для новогоднего приключения!". Сани готовы к старту!`,
  4: `Какой чудесный аромат! Ты спасла рождественское печенье, и теперь вся кухня Снеговика пахнет корицей и праздником. Главный Эльф-Кондитер пожал тебе руку: "{name}, у тебя отличный вкус! Сразу видно девочку, которая умеет находить правильные решения".`,
  5: `Гав-гав! Ура! Шарик прыгает от счастья, сжимая в зубах свой новый подарок. Он говорит на своем собачьем языке, что ты самая догадливая подруга на свете. "{name}, твоя доброта растопит любой лед," — улыбнулся Снеговик. Ты находишь подход к каждому!`,
  6: `ДА БУДЕТ СВЕТ! Елка вспыхнула тысячей разноцветных огней, озаряя весь темный лес. Это не просто электричество, это магия твоих касаний! Снеговик восторженно достал бенгальский огонь: "{name}, ты даришь свет всем вокруг!"`,
  7: `Невероятно! Дерево выросло крепким и красивым всего за одну секунду! Сама природа слушается тебя. "{name}, да ты прирожденная фея леса!" — воскликнули маленькие эльфы. Твое терпение и труд принесли свои волшебные плоды. Мы почти у цели!`,
  8: `Ура! Кукла спасена! Она заняла свое почетное место в мешке подарков. Снеговик записал в блокнот: "{name} — мастерица разгадывать тайны!". Буквы встали на свои места так четко, будто по взмаху волшебной палочки.`,
  9: `Тик-так! Часы пробили волшебный час. Ты победила само Время! Снеговик проверил свои большие карманные часы и выдохнул: "Мы успеваем! {name}, твоя скорость и острый ум просто поражают воображение!". Финал уже совсем близко!`,
  10: `УРА! САЛЮТ! Главная Елка Мира зажглась благодаря ТЕБЕ! Дед Мороз лично жмет твою руку. "{name}, ты совершила настоящее чудо!" Все испытания пройдены, путь к празднованию Нового года открыт! Пусть твое увлечение — {hobby} — приносит тебе радость весь год!`
};

export async function generateStory(userData, dayId, taskName) {
  await new Promise(resolve => setTimeout(resolve, 1000));
  const isGirl = userData.gender === 'girl';
  const templates = isGirl ? TEMPLATES_GIRL : TEMPLATES_BOY;
  let text = templates[dayId];
  if (!text) {
    text = `Молодец, {name}! День ${dayId} пройден успешно!`;
  }
  const safeName = userData.name || (isGirl ? 'Волшебница' : 'Волшебник');
  const safeHobby = userData.hobby || 'творение чудес';
  text = text.replaceAll('{name}', safeName);
  text = text.replaceAll('{hobby}', safeHobby);
  return text;
}
